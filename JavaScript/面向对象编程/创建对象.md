# åˆ›å»ºå¯¹è±¡

## åŸå‹é“¾

JavaScript å¯¹æ¯ä¸ªåˆ›å»ºçš„å¯¹è±¡éƒ½ä¼šè®¾ç½®ä¸€ä¸ªåŸå‹ï¼ŒæŒ‡å‘å®ƒçš„åŸå‹å¯¹è±¡ã€‚

å…·ä½“å«ä¹‰æ˜¯ï¼Œå½“æˆ‘ä»¬ç”¨`obj.xxx`è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶ï¼ŒJavaScript å¼•æ“ç°åœ¨å½“å‰å¯¹è±¡ä¸ŠæŸ¥æ‰¾è¿™ä¸€å±æ€§ï¼Œå¦‚æœæœªæ‰¾åˆ°ï¼Œå°±åˆ°å…¶åŸå‹å¯¹è±¡ä¸Šå»æ‰¾ï¼Œå¦‚æœè¿˜æœªæ‰¾åˆ°ï¼Œå°±ä¸€ç›´ä¸Šæº¯åˆ° `Object.prototype`å¯¹è±¡ï¼Œæœ€åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ‰¾åˆ°ï¼Œå°±è¿”å›`undefined`ã€‚

ä¸¾ä¸ªä¾‹å­ä¼šæ›´åŠ å½¢è±¡ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª `Array`å¯¹è±¡ï¼š

`var arr = [1, 2, 3];`

å…¶åŸå‹é“¾æ˜¯ï¼š

`arr --> Array.prototype --> Object.prototype --> null`

å†çœ‹ä¸€ä¸ªä¾‹å­ï¼Œå½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°æ—¶ï¼Œ

```
function foo() {
    return 0;
}
```

å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå…¶åŸå‹é“¾æ˜¯ï¼š

```
foo --> Function.prototype -->  Object.prototype --> null
```

å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œå¦‚æœåŸå‹é“¾å¾ˆé•¿ï¼Œé‚£ä¹ˆè®¿é—®ä¸€ä¸ªå¯¹è±¡çš„å±æ€§å°±ä¼šå› ä¸ºèŠ±æ›´å¤šçš„æ—¶é—´æŸ¥æ‰¾è€Œå˜å¾—æ›´æ…¢ï¼Œå› æ­¤**æ³¨æ„ä¸è¦æŠŠåŸå‹é“¾æå¾—å¤ªé•¿**ã€‚



## é€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡

ä¸€èˆ¬æƒ…å†µä¸‹æˆ‘ä»¬ä¼šé€‰æ‹©é€šè¿‡ `{...}`çš„æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ï¼Œä½†æ˜¯ JS è¿˜æ”¯æŒé€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼Œå…ˆå®šä¹‰ä¸€ä¸ªæ„é€ å‡½æ•°ï¼š

```
function Student(name) {
    this.name = name;
    this.hell0 = function() {
        alert('Hello, ' + this.name + '!');
    }
}
```

è¿™çœ‹èµ·æ¥å°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œä½†æ˜¯åœ¨ JS ä¸­ï¼Œå¯ä»¥ç”¨ `new` å…³é”®å­—æ¥è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶**è¿”å›ä¸€ä¸ªå¯¹è±¡**ï¼š

```
var xiaoming = new Student('å°æ˜');
xiaoming.name;
xiaoming.hello();
```

**Note**ï¼šå¦‚æœä¸å†™ `new` é‚£ä¹ˆ `Student` å°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°ï¼Œå®ƒè¿”å›`undefined`ã€‚ä½†æ˜¯å¦‚æœå†™äº†  `new` ï¼Œå®ƒå°±å˜æˆäº†ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œå®ƒç»‘å®šçš„ `this` æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ï¼Œå¹¶**é»˜è®¤è¿”å›this**ï¼Œå³ä¸éœ€è¦åœ¨æœ€åå†™ `return this;`ã€‚

æ–°å»ºçš„ `xiaoming` çš„åŸå‹é“¾æ˜¯ï¼š

`xiaoming --> Student.prototype --> Object.prototype --> null`

å¦‚æœä½ è¿˜åˆ›å»ºäº†xiaohongã€xiaojunï¼Œé‚£ä¹ˆè¿™äº›å¯¹è±¡çš„åŸå‹é“¾å’Œxiaomingæ˜¯ä¸€æ ·çš„ï¼š

```
xiaoming â†˜
xiaohong -â†’ Student.prototype ----> Object.prototype ----> null
xiaojun  â†—
```

ç”¨ `new Student()`åˆ›å»ºçš„å¯¹è±¡è¿˜ä»åŸå‹ä¸Šè·å¾—äº†ä¸€ä¸ª `constructor`å±æ€§ï¼Œå®ƒæŒ‡å‘å‡½æ•° `Student`æœ¬èº«ï¼š

```
xiaoming.constructor === Student.prototype.constructor; // true
Student.prototype.constructor === Student; // true
Object.getPrototypeOf(xiaoming) === Student.prototype; // true
xiaoming instanceof Student // true
```

 çœ‹ä¸Šé¢çš„è¿™äº›è¡¨è¾¾å¼å¯èƒ½æœ‰ç‚¹æ™•ï¼Œè®©æˆ‘ä»¬ç”¨ä¸€å¼ å›¾æ¥è§£é‡Šä¸€ä¸‹ï¼š

![image-20190724141708866](/Users/pengyuyan/Documents/Web-Learning-Material/JavaScript/é¢å‘å¯¹è±¡ç¼–ç¨‹/images/image-20190724141708866.png)

å…¶ä¸­ï¼Œçº¢è‰²ç®­å¤´æ˜¯åŸå‹é“¾ï¼Œ

- ç®­å¤´(1)è¡¨ç¤º`Student.prototype`æŒ‡å‘çš„å¯¹è±¡å°±æ˜¯`xiaoming`ã€`xiaohong`çš„åŸå‹å¯¹è±¡ï¼ŒæŒ‡å‘`student`å‡½æ•°æœ¬èº«ï¼›
- ç®­å¤´(2)è¡¨ç¤º`Student`æ°å¥½æœ‰ä¸ªå±æ€§æŒ‡å‘`xiaoming`ã€`xiaohong`çš„åŸå‹å¯¹è±¡ï¼Œä½†æ˜¯`xiaoming`ã€`xiaohong`çš„è¿™äº›å¯¹è±¡æ²¡æœ‰`prototype`è¿™äº›å±æ€§ï¼›
- ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¤ä¸º`xiaoming`ã€`xiaohong`è¿™äº›å¯¹è±¡â€ç»§æ‰¿â€œè‡ª`Student`ã€‚

è¿˜æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ

`xiaohong.hello == xiaoming.hello; // false`

`xiaoming`å’Œ`xiaohong`å„è‡ªçš„`hello`æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä½†å®ƒä»¬æ˜¯ä¸¤ä¸ª**ä¸åŒ**çš„å‡½æ•°ï¼Œè™½ç„¶å‡½æ•°åç§°å’Œä»£ç éƒ½æ˜¯ç›¸åŒçš„ï¼

å¦‚æœæˆ‘ä»¬é€šè¿‡`new Student()`åˆ›å»ºäº†å¾ˆå¤šå¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„`hello`å‡½æ•°å®é™…ä¸Šåªéœ€è¦**å…±äº«**åŒä¸€ä¸ªå‡½æ•°å°±å¯ä»¥äº†ï¼Œè¿™æ ·å¯ä»¥èŠ‚çœå¾ˆå¤šå†…å­˜ã€‚



é‚£ä¹ˆå¦‚ä½•åˆ›å»ºä¸€ä¸ªå…±äº«çš„ hello å‡½æ•°å‘¢ï¼Ÿ

æˆ‘ä»¬åªè¦æŠŠ hello å‡½æ•°ç§»åŠ¨åˆ°`xiaoming`ã€`xiaohong`è¿™äº›å¯¹è±¡çš„åŸå‹ä¸Šå»å°±å¯ä»¥äº†ï¼Œå³ `Student.prototype`ï¼Œå³

![image-20190724142438397](/Users/pengyuyan/Documents/Web-Learning-Material/JavaScript/é¢å‘å¯¹è±¡ç¼–ç¨‹/images/image-20190724142438397.png)

å…·ä½“ä»£ç å¦‚ä¸‹ï¼Œ

```
function Student(name) {
    this.name = name;
}

Student.prototype.hello = function() {
    alert('Hello, ' + this.name + "!");
}

var xiaoli = new Student('xiaoli');
var xiaolv = new Student('xiaolv');
xiaoli.name;
xiaolv.name;
xiaoli.hello === xiaolv.hello; // true
```





## å¿˜è®°å†™ new æ€ä¹ˆåŠ

å¦‚æœæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œä½†æ˜¯è°ƒç”¨çš„æ—¶å€™å¿˜äº†å†™å…³é”®å­— new æ€ä¹ˆåŠï¼Ÿ

åœ¨strictæ¨¡å¼ä¸‹ï¼Œ`this.name = name`å°†æŠ¥é”™ï¼Œå› ä¸º`this`ç»‘å®šä¸º`undefined`ï¼Œåœ¨éstrictæ¨¡å¼ä¸‹ï¼Œ`this.name = name`ä¸æŠ¥é”™ï¼Œå› ä¸º`this`ç»‘å®šä¸º`window`ï¼Œäºæ˜¯æ— æ„é—´åˆ›å»ºäº†å…¨å±€å˜é‡`name`ï¼Œå¹¶ä¸”è¿”å›`undefined`ï¼Œè¿™ä¸ªç»“æœæ›´ç³Ÿç³•ã€‚

æ‰€ä»¥ï¼Œè°ƒç”¨æ„é€ å‡½æ•°åƒä¸‡ä¸è¦å¿˜è®°å†™`new`ã€‚

ä¸ºäº†åŒºåˆ†æ™®é€šå‡½æ•°ä¸æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬ğŸˆ¶å¦‚ä¸‹çº¦å®šï¼Œ

- æ„é€ å‡½æ•°é¦–å­—æ¯åº”å½“å¤§å†™ï¼Œæ™®é€šå‡½æ•°é¦–å­—æ¯åº”è¯¥å°å†™ï¼Œè¿™æ ·ï¼Œä¸€äº›è¯­æ³•æ£€æŸ¥å·¥å…·å¦‚[jslint](http://www.jslint.com/)å°†å¯ä»¥å¸®ä½ æ£€æµ‹åˆ°æ¼å†™çš„`new`ï¼›

æ­¤å¤–ï¼Œè¿˜å¯ä»¥å°è¯•ä»¥ä¸‹æ–¹æ³•ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œç¼–å†™ä¸€ä¸ª `createStudent()`å‡½æ•°ï¼Œåœ¨å†…éƒ¨å°è£…æ‰€æœ‰çš„`new`æ“ä½œã€‚å¦‚ä¸‹ï¼Œ

```
function Student(props) {
    this.name = props.name || 'åŒ¿å';
    this.grade = props.grade || 1;
}

Student.prototype.hello = function() {
    alert('Hello, ' + this.name + '!');
};

function createStudent(props) {
    return new Student(props || {});
}
```

è¿™ä¸ª`createStudent`çš„ä¼˜ç‚¹æœ‰å‡ ä¸ªï¼Œ

1. ä¸éœ€è¦ `new`æ¥è°ƒç”¨ï¼›
2. å‚æ•°éå¸¸çµæ´»ï¼›

æ­¤å¤–ï¼Œå¦‚æœåˆ›å»ºçš„å¯¹è±¡æœ‰å¾ˆå¤šå±æ€§ï¼Œæˆ‘ä»¬åªéœ€è¦å…¶ä¸­çš„æŸäº›ï¼Œå…¶ä½™çš„å¯ä»¥è®¾ç½®ä¸ºé»˜è®¤ã€‚è€Œä¸”ç”±äºå‚æ•°æ˜¯ä¸€ä¸ª Objectï¼Œæˆ‘ä»¬æ— éœ€è®°å¿†å‚æ•°çš„é¡ºåºã€‚å¦‚æœæ­£å¥½ä» JSON æ‹¿åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç«‹é©¬å¾—åˆ° xiaomingã€‚